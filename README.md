# NeiroTolikBot

Telegram бот с поддержкой генерации текста через OpenRouter и изображений через PiAPI.ai.

### Основные функции
- [x] Генерация изображений
- [x] Обработка кастомных промптов
- [x] Память контекста для последних сообщений
- [x] Получение списка моделей
- [ ] Загрузка списка моделей в бота, чтобы к ним можно было обращаться
- [ ] Работа в групповых чатах
- [ ] Суммаризация контекста для групповых чатов
- [ ] Оценка объема контекста
- [ ] Суммаризация контекста и сохранение в БД
- [ ] Конфигурация окружения для тестового бота
- [ ] Обработка английских ключевых слов
- [ ] Модель для роутинга запросов
- [ ] Выбор модели по умолчанию (например, отвечай всегда антропиком или всегда сначала генери картинку)
- [ ] Возможность убрать системный промт (забудь что ты Нейротолик)
- [ ] Возможность отправить модель в loop для самодиалога (или диалога с другой моделью) до получения качественного ответа, определения невозможности ответа или пока не упрётся в лимит

### Улучшения интерфейса
- [ ] Индикация статуса генерации ответа
- [ ] Проверка размера контекста
- [ ] Команда "новый диалог" (сброс текущего диалога с сохранением общения с пользователем в саммари)
- [ ] Команды очистки памяти:
  - [ ] "очисти память"
  - [ ] "полностью очисти память"
  - [ ] "забудь всё"

### Технические улучшения
- [ ] Вынести генерацию изображений в отдельный модуль
- [ ] Разделить остальные функции по модулям
- [ ] Добавить дополнительные сети для генерации изображений
- [ ] Добавить возможность просмотра веб-страниц
- [ ] Уведомления о статусе бота
- [ ] Параллельный запуск нескольких моделей
- [ ] Система монетизации
- [ ] Горячая перезагрузка модулей без перезапуска бота

## Структура проекта

```
NeiroTolikBot/
├── handlers/              # Обработчики команд и сообщений
│   ├── commands.py       # Обработчики команд (например, /start)
│   └── messages.py       # Обработчики сообщений и логика маршрутизации
├── services/             # Сервисы генерации и другие сервисы
│   ├── generation.py     # Функции для генерации текста и изображений
│   └── memory.py        # Управление памятью и контекстом диалогов
├── utils/                # Вспомогательные функции
│   └── helpers.py        # Утилиты (экранирование, инициализация)
├── config.py            # Конфигурация бота
├── tbot.py              # Основной файл бота
├── .env                 # Переменные окружения
└── README.md           # Документация
```

## Установка и запуск

1. Клонируйте репозиторий
2. Установите зависимости:
   ```bash
   pip install -r requirements.txt
   ```
3. Создайте файл `.env` со следующими переменными:
   ```
   TELEGRAM_BOT_TOKEN=ваш_токен_бота
   OPENROUTER_API_KEY=ваш_ключ_openrouter
   PIAPI_KEY=ваш_ключ_piapi (опционально)
   CUSTOM_SYSTEM_PROMPT=ваш_промпт (опционально)
   ```
4. Запустите бота:
   ```bash
   python tbot.py
   ```

## Запуск в Docker

1. Соберите образ бота:
   ```bash
   docker build -t neirotolikbot:latest .
   ```

2. Создайте файл `.env` (можно взять за основу `.env.example`) и укажите реальные значения переменных:
   ```bash
   TELEGRAM_BOT_TOKEN=...
   OPENROUTER_API_KEY=...
   PIAPI_KEY=...            # опционально
   CUSTOM_SYSTEM_PROMPT=... # опционально
   ```

3. Запустите контейнер, передав переменные окружения из файла:
   ```bash
   docker run --env-file .env --name neirotolikbot -d neirotolikbot:latest
   ```

4. Просмотрите логи контейнера (опционально):
   ```bash
   docker logs -f neirotolikbot
   ```

## Возможности

- Генерация текста через различные модели (ChatGPT, Claude, DeepSeek)
- Генерация изображений через PiAPI.ai
- Работа в группах (требуется упоминание бота)
- Гибкая маршрутизация запросов
- Управление памятью и контекстом диалогов

## Использование

### Личные сообщения
- Просто напишите свой вопрос
- Укажите модель в начале или конце запроса
- Для генерации изображений используйте ключевые слова "нарисуй" или "сгенерируй картинку"

### Групповые чаты
- Упомяните бота в начале сообщения
- Используйте те же команды, что и в личных сообщениях

### Управление памятью
- `/new` - Начать новый диалог (сохраняет историю для будущего использования)
- `/clear` - Полностью очистить память бота
- `/help` - Показать справку по командам
