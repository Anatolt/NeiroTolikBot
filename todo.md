# TODO

- [x] "Принял, думаю над ответом"
- [ ] Реагировать на команду в личку в телеге: "зайди в дискорд"
- [ ] В диалоге сохранять, что пользователь писал голосовым сообщением или запрашивал генерацию картинки
- [ ] Проверить, не передается ли системный промпт в генерацию картинки
- [ ] Сделать, чтобы был виден промпт для генерации картинки
- [ ] Суммаризация контекста для групповых чатов
- [x] Оценка объема контекста
- [ ] Суммаризация контекста и сохранение в БД
- [ ] Конфигурация окружения для тестового бота
- [ ] Обработка английских ключевых слов
- [ ] Модель для роутинга запросов
- [ ] Выбор модели по умолчанию (например, отвечай всегда антропиком или всегда сначала генери картинку)
- [ ] Возможность убрать системный промт (забудь что ты Нейротолик)
- [ ] Возможность отправить модель в loop для самодиалога (или диалога с другой моделью) до получения качественного ответа, определения невозможности ответа или пока не упрётся в лимит
- [ ] Бот пишет админу об обновлении кода
- [ ] Бот пишет о ходе селф-тестов
- [x] Отображение "бот пишет"
- [x] Задержка перед ответом в 5-15 сек. Реальные люди не отвечают мгновенно, тем более простынями текста
- [x] Если текст длинный - разбивать его на несколько сообщений
- [ ] Ответ реакциями на сообщения в групповом чате
- [ ] Добавить в шапку время ответа
- [ ] Добавить команду /h для вывода help
- [ ] Ограничение длины голосовых сообщений
- [ ] Уточняющий промпт для распознавания работает плохо (просачивается в транскрипцию) — пока убрать
- [ ] Разобраться с уточняющим промптом о языках при транскрибации
- [x] Вывод текста распознанной голосовухи
- [x] Автоответ на голосовые сообщения без подтверждения (режим диалога)
- [ ] Ответ на голосовуху в группе через тег бота
- [ ] Ответ голосовыми сообщениями
- [ ] Показывать оценку стоимости распознавания для длинных голосовух
- [ ] Слушание беседы с отправкой суммаризации в чат
- [ ] Ответы на вопросы в голосовом чате, когда бот поймал запрос к себе
- [ ] Оценка кто сколько говорил
- [ ] Оценка эмоций
- [ ] Команда, чтобы видеть, в каких войс-чатах бот сейчас на связи
- [ ] Команда, чтобы выйти из всех войс-чатов
- [ ] Команда, чтобы выйти из конкретного войс-чата
- [ ] Звуковые дорожки для распознавания обрезаются слишком рано — мешает распознаванию
- [ ] Режимы записи: слушать все каналы сразу и отправлять один файл / слушать каждого участника отдельно (как сейчас)
- [ ] Доработать алгоритм нарезки аудио для распознавания (временный raw-режим)
- [ ] Возможность присоединяться к Jitsi, Telemost, Google Meet
- [ ] Подключить несколько апи сервисов для ллм
- консилиум
   - [x] Команда "консилиум" для одновременного запроса нескольких моделей (авто 3 модели или перечень из сообщения)
   - [x] фолбек если не указаны модели
   - [ ] сравнение ответов
   - [ ] голосование за ответ
   - [ ] консилиум для картинок
- [ ] добавить умение видеть картинки
- [ ] Добавить grok в шорткаты и вывести список шорткатов командой
- [ ] Затестить https://github.com/BerriAI/litellm
- [ ] Команда перезагрузки бота (только для админа)
- [x] Авторизация/режим админа в боте
- [ ] Добавить команды /admin_login и /admin_logout
- [ ] Оповещения о перезапуске, добавлении в новый чат, новых пользователях и статистика по ним
- [ ] В голосовых логах Discord выводить диалог последовательно, в реальном порядке реплик (не группировать по пользователям)

## План

- [ ] возможность добавить инструкции в промпт чата от конкретного пользователя
- [ ] возможность добавить инструкции о конкретных пользователях от админа. Пример: @anatolt продакт по профессии, любит короткие ответы @agentrickhr ребята консультируют по карьере, не любят общение на вы
- [ ] починить консилиум, вначале отвечает два раза одна и та же модель
- [ ] добавить ключевики gpt3 gpt4 gpt5
- [ ] добавить возможность задавать ключевики прямо в боте
- [ ] добавить боту доступ к поиску по его же коду
- [ ] отображение текущей системы роутинга прямо в сообщениях
- [ ] реакция на команду "отвечай всегда моделью такой-то"
- [ ] отключенная по умолчанию память (контекст по умолчанию = 1 сообщение)
- [ ] команда "обнови список моделей"

## Улучшения интерфейса

- [ ] Индикация статуса генерации ответа
- [x] Проверка размера контекста
- [x] Команда "новый диалог" (сброс текущего диалога с сохранением общения с пользователем в саммари)
- [ ] Команды очистки памяти:
  - [ ] "очисти память"
  - [ ] "полностью очисти память"
  - [ ] "забудь всё"

## Технические улучшения

- [ ] Вынести генерацию изображений в отдельный модуль
- [ ] Разделить остальные функции по модулям
- [ ] Зарефакторить `discord_bot.py` — файл слишком большой
- [ ] Добавить дополнительные сети для генерации изображений
- [ ] Добавить возможность просмотра веб-страниц
- [ ] Уведомления о статусе бота
- [x] Параллельный запуск нескольких моделей -> консилиум
- [ ] Система монетизации
- [ ] Горячая перезагрузка модулей без перезапуска бота
- [ ] Работа с голосовухами
   - [ ] 1 Возможность кинуть голосовое и оценку длительности его обработки
   - [ ] 2 Возможность кинуть голосовое и получить его расшифровку
   - [ ] 3 Возможность кинуть голосовое и получить его саммари
   - [ ] 4 Возможность написать боту голосовое и он ответит текстом

## Тестирование

- [ ] Тесты API сервисов (OpenRouter и PiAPI.ai)
- [ ] Система автотестов запросов в API (без генерации, с проверкой доступности и корректности ответов API)
- Команда `/selftest` запускает офлайн-проверку слеш-команд и отправляет файл с результатами.

## План тестирования после изменений

- Прогнать тесты через встроенный инструмент тестирования проекта.
- Проверить ответы бесплатных моделей и корректность их выбора.
- Проверить работу всех слеш-команд (включая списки моделей, консилиум, перезагрузку памяти и т.п.).
- Проверить ответы консилиума и корректное объединение результатов.
- Вывести результаты проверки после выполнения тестов.
